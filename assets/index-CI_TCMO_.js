var v=Object.defineProperty;var S=(e,t,n)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var g=(e,t,n)=>S(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();class w{constructor(t,n){g(this,"state");g(this,"scenes");this.scenes=Object.fromEntries(t.map(r=>[r.id,r])),this.state={scene:n,inventory:{},history:[]}}getCurrentScene(){return this.scenes[this.state.scene]}chooseOption(t){const n=this.getCurrentScene(),r=n.options[t];r.effect&&r.effect(this.state),this.state.history.push(n.id),this.state.scene=r.nextScene}getState(){return{...this.state}}}function a(e,t,n=1){e.inventory[t]||(e.inventory[t]=0),e.inventory[t]+=n}const P=[{id:"burning-bush",description:'You see a bush that burns but is not consumed. A voice calls your name: "Moses, Moses!"',backgroundImage:"burning-bush.png",bibleVerse:{book:"Exodus",chapter:3,verses:[2]},options:[{text:"Approach the bush",nextScene:"god-speaks",effect:e=>{a(e,"faith")}},{text:"Run away",nextScene:"run-away"},{text:"Look for a staff nearby",nextScene:"find-staff",effect:e=>{a(e,"staff")}}]},{id:"find-staff",description:"You find a sturdy staff on the ground. It may be useful later.",options:[{text:"Return to the bush",nextScene:"god-speaks"}]},{id:"god-speaks",description:'God speaks to you from the bush: "Take off your sandals, for the place where you are standing is holy ground."',options:[{text:"Remove sandals and listen",nextScene:"mission",effect:e=>{a(e,"obedience")}}]},{id:"run-away",description:"You run away, but the memory of the burning bush stays with you.",options:[{text:"Return to the bush",nextScene:"burning-bush"}]},{id:"mission",description:'God gives you a mission: "Go to Pharaoh and bring my people out of Egypt."',options:[{text:"Accept the mission",nextScene:"accepted",effect:e=>{a(e,"trust")}},{text:"Refuse",nextScene:"refused"}]},{id:"accepted",description:"You accept God’s mission. Your journey begins! You travel to Egypt to confront Pharaoh.",options:[{text:"Go to Pharaoh’s palace",nextScene:"pharaoh-palace"}]},{id:"refused",description:"You refuse, but God encourages you to trust Him.",options:[{text:"Accept the mission",nextScene:"accepted"}]},{id:"pharaoh-palace",description:'You stand before Pharaoh. He looks at you with suspicion. "Let my people go," you declare.',options:[{text:"Demand release",nextScene:"pharaoh-refuses"},{text:"Show a sign",nextScene:"staff-to-snake",effect:e=>{a(e,"borrowed staff")}},{text:"Offer a gift",nextScene:"pharaoh-softens"}]},{id:"pharaoh-softens",description:"Pharaoh is surprised by your gift. He seems less hostile, but still refuses to let the people go.",options:[{text:"Warn of plagues",nextScene:"plagues-begin"},{text:"Try to negotiate",nextScene:"negotiation"}]},{id:"negotiation",description:"You attempt to negotiate with Pharaoh. He offers to let only some people go.",options:[{text:"Accept partial freedom",nextScene:"partial-freedom"},{text:"Insist on full freedom",nextScene:"pharaoh-refuses"}]},{id:"partial-freedom",description:"Some Israelites are freed, but many remain. The story ends with hope for the rest.",options:[]},{id:"pharaoh-refuses",description:"Pharaoh refuses to let the Israelites go. God tells you to warn him of plagues.",options:[{text:"Warn of plagues",nextScene:"plagues-begin"}]},{id:"staff-to-snake",description:"You throw your staff down and it becomes a snake! Pharaoh’s magicians do the same. Pharaoh is unimpressed.",options:[{text:"Warn of plagues",nextScene:"plagues-begin",effect:e=>{a(e,"perseverance")}}]},{id:"plagues-begin",description:"The plagues begin: water turns to blood, frogs, gnats, and more. Pharaoh’s heart remains hard.",options:[{text:"Continue with more plagues",nextScene:"final-plague"}]},{id:"final-plague",description:"The final plague strikes: the death of the firstborn. Pharaoh finally lets the Israelites go.",options:[{text:"Lead the people out",nextScene:"red-sea"}]},{id:"red-sea",description:"You reach the Red Sea. Pharaoh’s army is pursuing you! The people panic.",options:[{text:"Raise your staff",nextScene:"sea-parts",effect:e=>{a(e,"miraculous staff"),a(e,"deliverance")}},{text:"Pray for help",nextScene:"sea-parts",effect:e=>{a(e,"deliverance")}},{text:"Look for another way around",nextScene:"lost-in-desert"}]},{id:"lost-in-desert",description:"You try to find another way, but get lost in the desert. The journey is much harder.",options:[{text:"Return to the sea",nextScene:"red-sea"}]},{id:"sea-parts",description:"The sea miraculously parts! Do you lead the people through?",options:[{text:"Go back to the safety of Egypt and rule under Pharaoh.",nextScene:"partial-freedom"},{text:"Lead the people through the sea",nextScene:"crossing-red-sea"}]},{id:"crossing-red-sea",description:"You lead the people through the dry seabed. The waters close behind you, drowning Pharaoh’s army.",options:[{text:"Celebrate the deliverance",nextScene:"mount-sinai",effect:e=>{a(e,"deliverance")}}]},{id:"mount-sinai",description:"At Mount Sinai, God gives you the Ten Commandments. The people begin a new life as a free nation.",options:[{text:"Reflect on the journey",nextScene:"end",effect:e=>{a(e,"wisdom")}}]},{id:"end",description:"You have led your people out of Egypt and received God’s law. The adventure continues in the wilderness...",options:[]}];function k(e,t){return e.id==="pharaoh-palace"||e.id==="red-sea"?e.options.filter(n=>n.text.toLowerCase().includes("staff")?t.inventory.staff>0:!0):e.options}const y=new w(P,"burning-bush");async function $(e){var t,n;if(!e||!e.book||!e.chapter||!e.verses)return console.warn("Invalid Bible verse reference:",e),"";console.log("Fetching Bible verse:",e);try{const o=await(await fetch(`https://bible.helloao.org/api/ENGWEBP/${e.book}/${e.chapter}.json`)).json(),s=(n=(t=o==null?void 0:o.chapter)==null?void 0:t.content)==null?void 0:n.filter(u=>e.verses.includes(u.number));if(!s)return console.warn("No verses found for reference:",e),"";console.log("Fetched verses:",s);const d=s.map(u=>(console.log("Processing verse:",u),u.content.map(i=>{if(console.log("Processing text part:",i),typeof i=="string")return i}).join(" "))),h=e.chapter.toString(),f=e.verses.join(", ");return d?`<div class='bible-verse'><span class='bible-ref'>Exodus ${h}:${f}</span> — <span class='bible-text'>${d}</span></div>`:(console.warn("No text found for verses:",e.verses),"")}catch(r){return console.error("Error fetching Bible verse:",e),console.error(r),""}}async function b(){const e=y.getCurrentScene(),t=document.querySelector("#app");if(!t)return;const n=y.getState();let r="";const o=Object.entries(n.inventory);o.length>0?r=`
      <div class="header-inventory-dropdown">
        <button class="inventory-dropdown-toggle" aria-haspopup="listbox" aria-expanded="false">Inventory (${o.length}) ▼</button>
        <div class="inventory-dropdown-list" style="display:none;">
          ${o.map(([c,p])=>`
            <div class="inventory-box"><span class="inventory-item">${c}</span><span class="inventory-count">${p}</span></div>
          `).join("")}
        </div>
      </div>
    `:r='<div class="header-inventory-list">Nothing</div>';const s=`
    <header class="game-header">
      <span class="header-title">Exodus Adventure</span>
      ${r}
    </header>
  `;let d="";e.backgroundImage&&(d=`<div class="scene-background"><img src="${e.backgroundImage}" alt="Scene background" /></div>`);let h="";e.bibleVerse&&(h=await $(e.bibleVerse));let f="";const u=k(e,n);t.innerHTML=`
    ${s}
    <div class="game-container">
      ${f}
      ${d}
      <div class="scene-description">${e.description}</div>
      <div class="options">
        ${u.map((c,p)=>`<button data-index="${p}">${c.text}</button>`).join("")}
      </div>
      <div class="scene-bible-verse">${h}</div>
    </div>
  `;const l=t.querySelector(".inventory-dropdown-toggle"),i=t.querySelector(".inventory-dropdown-list");l&&i&&(i.style.display="none",l.setAttribute("aria-expanded","false"),l.addEventListener("click",c=>{c.stopPropagation(),i.style.display==="none"?(i.style.display="flex",l.setAttribute("aria-expanded","true")):(i.style.display="none",l.setAttribute("aria-expanded","false"))}),document.addEventListener("click",c=>{!l.contains(c.target)&&!i.contains(c.target)&&(i.style.display="none",l.setAttribute("aria-expanded","false"))},!0)),t.querySelectorAll(".options button").forEach((c,p)=>{c.addEventListener("click",()=>{const x=e.options.findIndex(m=>m.text===u[p].text);y.chooseOption(x),b()})})}b();
